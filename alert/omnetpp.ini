[General]

network = SatelliteAlertGrid

# Basic simulation settings

warmup-period = ${warmupPeriod=5}s
sim-time-limit = 120s
repeat = 1
cmdenv-express-mode = true
cmdenv-autoflush = true
cmdenv-status-frequency = 1s
debug-on-errors = true

##############################
# Physical environment
##############################
# Full map size (your WGS-converted 10 km × 10 km grid)
*.playgroundSizeX = 10000m
*.playgroundSizeY = 10000m
*.playgroundSizeZ = 800km    
*.physicalEnvironment.ground.typename = "FlatGround"

##############################
# IPv4 configuration (Global configurator)
##############################
*.configurator.typename = "Ipv4NetworkConfigurator"
*.configurator.assignDisjunctSubnetAddresses = true
*.configurator.addStaticRoutes = true
*.configurator.addMulticastRoutes = true
*.configurator.addDefaultRoutes = true


##############################
# TraCI (SUMO) and vehicle insertion
##############################
*.manager.launchConfig   = xmldoc("my_5km_grid.launchd.xml")
*.manager.host           = "localhost"
*.manager.port           = 9999
*.manager.moduleType     = "space_veins.nodes.SatCar"
*.manager.moduleName     = "node"         # vehicles go into node[]
*.manager.updateInterval = 0.1s
*.manager.autoShutdown   = true

# No random vehicles; use the route file only
*.vehicleInserter.numVehicles = 0

##########################################################
#                        SOP                             #
##########################################################

*.sop.sumoNetXmlFile = xmldoc("my_5km_grid_wgs.net.xml")
*.sop.mobility.updateFromDisplayString = false
*.sop.mobility.initFromDisplayString   = false
*.sop.mobility.initialX = 5000m
*.sop.mobility.initialY = 5000m
*.sop.mobility.initialZ = 0m

##############################
# Satellite inserter
##############################
# TLE-driven constellation insertion + SGP4 epoch
*.satelliteInserter.ignoreUnknownSatellites = false
*.satelliteInserter.pathToTleFile = "space_Veins-1.txt"
*.satelliteInserter.wall_clock_sim_start_time_utc = "2022-02-22-13-42-34"


##############################
# Satellite radio medium
##############################
*.satelliteRadioMedium.typename = "UnitDiskRadioMedium"
*.satelliteRadioMedium.mediumLimitCache.minElevationAngleV2S = 5deg
*.satelliteRadioMedium.mediumLimitCache.disableS2SCommunication = true



##############################
# Satellites (dynamic) — SGP4
##############################
*.leo*[*].mobility.typename = "SGP4Mobility"
*.leo*[*].mobility.updateInterval = 1s
*.leo*[*].mobility.enableCache = true
*.leo*[*].mobility.precalculationIntervalInMinutes = 16

# Use the wrapper for the IPv4 network layer so we can enable forwarding
*.leo[*].nl.typename = "compat.CompatIpv4Layer"

# Give satellites an IPv4 stack and multicast forwarding
*.leo*[*].hasIpv4 = true
*.leo*[*].forwarding = true
*.leo*[*].multicastForwarding = true 
*.leo*[*].igmp.typename = "Igmpv2Router"
#**.leo*[*].routingTable.routes = xmldoc("mroutes.xml")
**.routingTable.routes = xmldoc("mroutes.xml")


# Optional: keep a sink to observe arrivals (doesn't block forwarding)
*.leo*[*].numApps = 1
*.leo*[*].app[0].typename = "inet.applications.udpapp.UdpSink"
#*.leo*[*].app[0].interface = "satNic0"
*.leo*[*].app[0].localPort = 4000
*.leo*[*].app[0].receiveBroadcast = true
#*.leo*[*].app[0].joinLocalMulticastGroups = true

*.leo*[*].numLoInterfaces = 0
*.leo*[*].numSatelliteNics = 2

##############################
# Vehicles (SatCar)
##############################
*.node[*].mobility.typename = "VeinsInetMobility"
*.node[*].numSatelliteNics = 1
*.node[*].numLoInterfaces   = 0
*.node[*].hasIpv4           = true
*.node[*].useSamac          = false

# Use the wrapper for the IPv4 network layer no forwarding
*.node[*].nl.typename= "compat.CompatIpv4Layer"

# Cars do not forward
*.node[*].forwarding = false
*.node[*].multicastForwarding = false


##############################
# Satellite NICs (cars + satellites)
##############################
#*.**.satNic[0].typename = "SatelliteInterface"
#*.**.satNic[0].mac.typename = "AckingMac"
#*.**.satNic[0].mac.headerLength = 32B
#*.**.satNic[0].mac.fullDuplex = true
#*.**.satNic[0].mac.useAck = false

#*.**.satNic[0].radio.typename = "UnitDiskRadio"
#*.**.satNic[0].radio.radioMediumModule = "satelliteRadioMedium"
#*.**.satNic[0].radio.antenna.mobilityModule = "^.^.^.mobility"
#*.**.satNic[0].radio.transmitter.communicationRange = 1000km
#*.**.satNic[0].radio.transmitter.headerLength = 8bit
#*.**.satNic[0].radio.transmitter.preambleDuration = 0s

# Lower metric is preferred; make satNic1 “better” for downstream
#*.leo*[*].ipv4.routingTable.rules =[{interface:"satNic1", metric:10}, {interface:"satNic0", metric:100}]


# Asymmetric link rates
#*.leo*[*].satNic[0].mac.bitrate = 100Mbps
#*.node[*].satNic[0].mac.bitrate = 10Mbps
#*.leo*[*].satNic[0].radio.transmitter.bitrate = 100Mbps
#*.node[*].satNic[0].radio.transmitter.bitrate = 10Mbps

# Interference handling
#*.leo*[*].satNic[0].radio.receiver.ignoreInterference = false
#*.node[*].satNic[0].radio.receiver.ignoreInterference = true

# Satellite/car NIC type for ALL satellite NICs (0 and 1) and cars
*.**.satNic[*].typename = "SatelliteInterface"

# MAC on all satellite NICs
*.**.satNic[*].mac.typename      = "AckingMac"
*.**.satNic[*].mac.headerLength  = 32B
*.**.satNic[*].mac.fullDuplex    = true
*.**.satNic[*].mac.useAck        = false

# Radio on all satellite NICs
*.**.satNic[*].radio.typename                  = "UnitDiskRadio"
*.**.satNic[*].radio.radioMediumModule         = "satelliteRadioMedium"
*.**.satNic[*].radio.antenna.mobilityModule    = "^.^.^.mobility"
*.**.satNic[*].radio.transmitter.communicationRange = 1000km
*.**.satNic[*].radio.transmitter.headerLength  = 8bit
*.**.satNic[*].radio.transmitter.preambleDuration = 0


##############################
# Application layer
##############################
# Everyone has exactly one app
*.node[*].numApps = 1

# --- Car 0: SENDER ONLY ---
*.node[0].app[0].typename      = "inet.applications.udpapp.UdpBasicApp"
#*.node[0].app[0].destAddresses = "224.0.0.1"
*.node[0].app[0].destAddresses = "239.1.1.1"
*.node[0].app[0].destPort      = 4000
*.node[0].app[0].localPort     = 4000
*.node[0].app[0].messageLength = 50B
*.node[0].app[0].packetName    = "Alert"
*.node[0].app[0].receiveBroadcast         = false           # sender only
*.node[0].app[0].joinLocalMulticastGroups = true            # join group to be standard-compliant
*.node[0].app[0].startTime     = 7s                        # first send at 7 s
*.node[0].app[0].sendInterval  = 10s                       # periodic forever
*.node[0].app[0].stopTime      = -1s
*.node[*].numWlanInterfaces = 0

# --- Cars 1..4: RECEIVERS ONLY ---
*.node[1..4].igmp.typename = "Igmpv2Host"

*.node[1..4].app[0].typename   = "inet.applications.udpapp.UdpSink"
*.node[1..4].app[0].localPort  = 4000
*.node[1..4].app[0].receiveBroadcast         = true
*.node[1..4].app[0].joinLocalMulticastGroups = true
*.node[1..4].app[0].startTime  = 2s                         # begin receiving at 2 s
#*.node[1..4].app[0].stopTime   = -1s
*.node[1..4].app[0].multicastInterface = "wlan[0]"




# Asymmetric link rates (apply to all sat NICs now)
*.leo*[*].satNic[*].mac.bitrate                = 100Mbps
*.node[*].satNic[*].mac.bitrate                = 10Mbps
*.leo*[*].satNic[*].radio.transmitter.bitrate  = 100Mbps
*.node[*].satNic[*].radio.transmitter.bitrate  = 10Mbps

# Interference handling
*.leo*[*].satNic[*].radio.receiver.ignoreInterference  = false
*.node[*].satNic[*].radio.receiver.ignoreInterference  = true


##############################
# Visualisation: rings + fading links
##############################
*.visualizer.*.radioVisualizer[0].displayRadios = false
*.visualizer.*.mediumVisualizer[0].displaySignals = false
*.visualizer.*.dataLinkVisualizer[0].displayLinks = false
*.visualizer.*.packetRouteVisualizer[0].displayRoutes = false

# WLAN (kept for compatibility, but ineffective due to 1 m range)
*.wlanRadioMedium.typename = "Ieee80211DimensionalRadioMedium"
*.**.wlan[*].opMode = "p"
*.**.wlan[*].mgmt.typename = "Ieee80211MgmtAdhoc"
*.**.wlan[*].agent.typename = ""
*.**.wlan[*].radio.typename = "Ieee80211DimensionalRadio"
*.**.wlan[*].radio.radioMediumModule = "wlanRadioMedium"


##############################
# Recording
##############################

**.globalStatistics.*.scalar-recording = true
**.globalStatistics.*.vector-recording = true
**.vehicleStatistics.*.scalar-recording = true
*.node[*].app[0].rcvdPkLifetime:vector.vector-recording = true
*.node[*].app[0].packetReceived:count.scalar-recording = true
*.node[*].app[0].packetSent:count.scalar-recording = true


**.scalar-recording = true
**.vector-recording = true




