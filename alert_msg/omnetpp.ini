[General]

##############################
# Basic simulation settings
##############################
warmup-period = ${warmupPeriod=5}s
sim-time-limit = 120s
repeat = 1
cmdenv-express-mode = true
cmdenv-autoflush = true
cmdenv-status-frequency = 1s
debug-on-errors = true

##############################
# Select the network to run
##############################
network = SatelliteAlertGrid

# Full map size (your WGS-converted 10 km × 10 km grid)
*.playgroundSizeX = 10000m
*.playgroundSizeY = 10000m
*.playgroundSizeZ = 600km    # must exceed satellite altitude

##############################
# IPv4 configuration
##############################
*.configurator.typename = "Ipv4NetworkConfigurator"
*.configurator.assignDisjunctSubnetAddresses = true
*.configurator.addStaticRoutes = true
*.configurator.addMulticastRoutes = true
*.configurator.addDefaultRoutes = true

##############################
# TraCI (SUMO) and vehicle insertion
##############################
*.manager.launchConfig   = xmldoc("my_5km_grid.launchd.xml")
*.manager.host           = "localhost"
*.manager.port           = 9999
*.manager.moduleType     = "space_veins.nodes.SatCar"
*.manager.moduleName     = "node"         # vehicles go into node[]
*.manager.updateInterval = 0.1s
*.manager.autoShutdown   = true

# No random vehicles; use the route file only
*.vehicleInserter.numVehicles = 0

##############################
# Physical environment
##############################
*.physicalEnvironment.ground.typename = "FlatGround"

##############################
# Satellite radio medium
##############################
*.satelliteRadioMedium.typename = "UnitDiskRadioMedium"
*.satelliteRadioMedium.mediumLimitCache.minElevationAngleV2S = 25deg
*.satelliteRadioMedium.mediumLimitCache.disableS2SCommunication = true

*.satelliteRadioMedium.mediumLimitCache.disableV2VCommunication = true

##############################
# Satellite inserter & SOP
##############################
# TLE-driven constellation insertion + SGP4 epoch
*.satelliteInserter.ignoreUnknownSatellites = false
*.satelliteInserter.pathToTleFile = "space_Veins-1.txt"
*.satelliteInserter.wall_clock_sim_start_time_utc = "2022-02-22-13-42-34"

# SOP: use your WGS net and center it
*.sop.sumoNetXmlFile = xmldoc("my_5km_grid_wgs.net.xml")
*.sop.mobility.updateFromDisplayString = false
*.sop.mobility.initFromDisplayString   = false
*.sop.mobility.initialX = 5000m
*.sop.mobility.initialY = 5000m
*.sop.mobility.initialZ = 0m

##############################
# Satellites (dynamic) — SGP4
##############################
*.leo*[*].mobility.typename = "SGP4Mobility"
*.leo*[*].mobility.updateInterval = 1s
*.leo*[*].mobility.enableCache = true
*.leo*[*].mobility.precalculationIntervalInMinutes = 16

# Give satellites an IPv4 stack and multicast forwarding
*.leo*[*].hasIpv4 = true
*.leo*[*].ipv4.forwarding = true
*.leo*[*].ipv4.multicastForwarding = true
# 
*.leo*[*].igmp.typename = "Igmpv2Router"

# Optional: keep a sink to observe arrivals (doesn't block forwarding)
*.leo*[*].numApps = 1
*.leo*[*].app[0].typename = "inet.applications.udpapp.UdpSink"
*.leo*[*].app[0].interface = "satNic0"
*.leo*[*].app[0].localPort = 4000
*.leo*[*].app[0].receiveBroadcast = true
*.leo*[*].app[0].joinLocalMulticastGroups = true

*.leo*[*].numLoInterfaces = 0
*.leo*[*].numSatelliteNics = 1

##############################
# Vehicles (SatCar)
##############################
*.node[*].mobility.typename = "VeinsInetMobility"
*.node[*].numSatelliteNics = 1
*.node[*].numLoInterfaces   = 0
*.node[*].hasIpv4           = true
*.node[*].useSamac          = false
# Join multicast groups at hosts:
*.node[*].igmp.typename     = "Igmpv2"

# Kill direct V2V: keep WLAN medium present but range ~0
*.connectionManager.sendDirect = true
*.connectionManager.maxInterfDist = 1m
*.connectionManager.drawMaxIntfDist = false

# WLAN (kept for compatibility, but ineffective due to 1 m range)
*.wlanRadioMedium.typename = "Ieee80211DimensionalRadioMedium"
*.**.wlan[*].opMode = "p"
*.**.wlan[*].mgmt.typename = "Ieee80211MgmtAdhoc"
*.**.wlan[*].agent.typename = ""
*.**.wlan[*].radio.typename = "Ieee80211DimensionalRadio"
*.**.wlan[*].radio.radioMediumModule = "wlanRadioMedium"

##############################
# Satellite NICs (cars + satellites)
##############################
*.**.satNic[0].typename = "SatelliteInterface"
*.**.satNic[0].mac.typename = "AckingMac"
*.**.satNic[0].mac.headerLength = 32B
*.**.satNic[0].mac.fullDuplex = true
*.**.satNic[0].mac.useAck = false

*.**.satNic[0].radio.typename = "UnitDiskRadio"
*.**.satNic[0].radio.radioMediumModule = "satelliteRadioMedium"
*.**.satNic[0].radio.antenna.mobilityModule = "^.^.^.mobility"
*.**.satNic[0].radio.transmitter.communicationRange = 10km
*.**.satNic[0].radio.transmitter.headerLength = 8bit
*.**.satNic[0].radio.transmitter.preambleDuration = 0s

# Asymmetric link rates
*.leo*[*].satNic[0].mac.bitrate = 100Mbps
*.node[*].satNic[0].mac.bitrate = 10Mbps
*.leo*[*].satNic[0].radio.transmitter.bitrate = 100Mbps
*.node[*].satNic[0].radio.transmitter.bitrate = 10Mbps

# Interference handling
*.leo*[*].satNic[0].radio.receiver.ignoreInterference = false
*.node[*].satNic[0].radio.receiver.ignoreInterference = true

##############################
# Application layer
##############################
# Everyone has exactly one app
*.node[*].numApps = 1

# --- Car 0: SENDER ONLY ---
*.node[0].app[0].typename      = "inet.applications.udpapp.UdpBasicApp"
*.node[0].app[0].destAddresses = "224.0.0.1"
*.node[0].app[0].destPort      = 4000
*.node[0].app[0].localPort     = 4000
*.node[0].app[0].messageLength = 50B
*.node[0].app[0].packetName    = "Alert"
*.node[0].app[0].receiveBroadcast         = false           # sender only
*.node[0].app[0].joinLocalMulticastGroups = true            # join group to be standard-compliant
*.node[0].app[0].startTime     = 15s                        # first send at 15 s
*.node[0].app[0].sendInterval  = 10s                       # periodic forever
*.node[0].app[0].stopTime      = -1s

# --- Cars 1..4: RECEIVERS ONLY ---
*.node[1..4].app[0].typename   = "inet.applications.udpapp.UdpSink"
*.node[1..4].app[0].localPort  = 4000
*.node[1..4].app[0].receiveBroadcast         = true
*.node[1..4].app[0].joinLocalMulticastGroups = true
*.node[1..4].app[0].startTime  = 5s                         # begin receiving at 5 s
*.node[1..4].app[0].stopTime   = -1s
##############################
# Visualisation: rings + fading links
##############################
# Radios (cars + satellites)
*.visualizer.*.radioVisualizer[0].displayRadios = true
*.visualizer.*.radioVisualizer[0].displayAntennaLobes = true
*.visualizer.*.radioVisualizer[0].radioFilter = "*.node[*].satNic[*].radio or *.leo*[*].satNic[*].radio"

# Signal rings (medium visualizer)
*.visualizer.*.mediumVisualizer[0].displaySignals = true
*.visualizer.*.mediumVisualizer[0].displayTransmissions = true
*.visualizer.*.mediumVisualizer[0].displayReceptions = true
*.visualizer.*.mediumVisualizer[0].signalPropagationAnimationSpeed = 1.0

# Fading link arrows on each hop (L2)
*.visualizer.*.dataLinkVisualizer[0].displayLinks = true
*.visualizer.*.dataLinkVisualizer[0].fadeOutMode = "time"
*.visualizer.*.dataLinkVisualizer[0].fadeOutTime = 2s
*.visualizer.*.dataLinkVisualizer[0].nodeFilter = "*.node[*] or *.leo*[*]"
*.visualizer.*.dataLinkVisualizer[0].packetFilter = "*"

# Mobility visuals (vehicles + antenna tracks)
*.visualizer.*.numMobilityVisualizers = 3
*.visualizer.*.mobilityVisualizer[*].displayMobility = true
*.visualizer.*.mobilityVisualizer[*].displayPositions = true
*.visualizer.*.mobilityVisualizer[*].displayOrientations = true
*.visualizer.*.mobilityVisualizer[*].displayVelocities = true
*.visualizer.*.mobilityVisualizer[*].displayMovementTrails = true
*.visualizer.*.mobilityVisualizer[0].moduleFilter = "*.node[*].mobility"
*.visualizer.*.mobilityVisualizer[1].moduleFilter = "*.node[*].satNic[*].radio.antenna.mobility"
*.visualizer.*.mobilityVisualizer[1].positionCircleRadius = 20
*.visualizer.*.mobilityVisualizer[1].positionCircleFillColor = "yellow"
*.visualizer.*.mobilityVisualizer[1].orientationFillColor = "yellow"
*.visualizer.*.mobilityVisualizer[2].moduleFilter = "*.wlan[*].radio.antenna.mobility"
*.visualizer.*.mobilityVisualizer[2].orientationFillColor = "red"

##############################
# Recording
##############################
**.scalar-recording = true
**.vector-recording = true
