[General]

#################################################################
# 1. Network + satellite host type
#################################################################

network = SatelliteAlertGrid

# Use our custom satellite host type that embeds MulticastConfigurator
# NOTE: this MUST match the NED type name in McastSatellite.ned.
*.satelliteType = "mcast.McastSatellite"

# Ensure SatelliteInserter creates satellites with the McastSatellite type so that
# the embedded MulticastConfigurator submodule runs on dynamically created
# satellites. Without this, satellites created from TLEs use the default
# space_veins.nodes.Satellite type and do not install multicast routes.
*.satelliteInserter.satelliteModuleType = "mcast.McastSatellite"

# MulticastConfigurator parameters for satellites.
# These describe the (*,G) route you want:
#  - Group: 239.1.1.1
#  - "Uplink" in-interface  : satNic0 (cars → satellite)
#  - "Downlink" out-interface: satNic0 (satellite → cars)
# NOTE: Changed from satNic1 to satNic0 because vehicles only have satNic0
# and the multicast must use the same interface for uplink and downlink
# when all nodes are on the same radio medium (satelliteRadioMedium).
# NOTE: Use mcast* prefix - these are McastSatellite module parameters,
# which are internally mapped to MulticastConfigurator submodule parameters in McastSatellite.ned
**.leo*[*].mcastGroupAddress   = "239.1.1.1"
**.leo*[*].mcastOriginAddress  = "0.0.0.0"
**.leo*[*].mcastOriginNetmask  = "0.0.0.0"
**.leo*[*].mcastInInterface    = "satNic0"
**.leo*[*].mcastOutInterfaces  = "satNic1"

*.numGeos = 0
#################################################################
# 2. Basic simulation settings
#################################################################

warmup-period           = ${warmupPeriod=5}s
sim-time-limit          = 120s
repeat                  = 1
cmdenv-express-mode     = true
cmdenv-autoflush        = true
cmdenv-status-frequency = 1s
debug-on-errors         = true

#################################################################
# 3. Physical environment
#################################################################

# Full map size (your WGS-converted 10 km × 10 km grid)
*.playgroundSizeX = 50000m
*.playgroundSizeY = 50000m
*.playgroundSizeZ = 6000km
*.physicalEnvironment.ground.typename = "FlatGround"

#################################################################
# 4. IPv4 configuration (Global configurator)
#################################################################

*.configurator.typename                 = "Ipv4NetworkConfigurator"
*.configurator.assignDisjunctSubnetAddresses = true
*.configurator.addStaticRoutes          = true
#*.configurator.addMulticastRoutes       = true
*.configurator.addDefaultRoutes         = true

# Feed static routes (incl. multicast routes) from mroutes.xml.
# This is purely config-driven (INI + XML), no extra C++ magic.
#**.routingTable.routes = xmldoc("mroutes.xml")

#################################################################
# 5. TraCI (SUMO) and vehicle insertion
#################################################################

*.manager.launchConfig   = xmldoc("my_5km_grid.launchd.xml")
*.manager.host           = "localhost"
*.manager.port           = 9999
*.manager.moduleType     = "space_veins.nodes.SatCar"
*.manager.moduleName     = "node"         # vehicles go into node[]
*.manager.updateInterval = 0.1s
*.manager.autoShutdown   = true

# No random vehicles; use the route file only
#*.vehicleInserter.numVehicles = 0

##########################################################
# 6. SOP (position of the observer / reference point)
##########################################################

*.sop.sumoNetXmlFile                  = xmldoc("my_5km_grid_wgs.net.xml")
*.sop.mobility.updateFromDisplayString = false
*.sop.mobility.initFromDisplayString   = false
*.sop.mobility.initialX               = 5000m
*.sop.mobility.initialY               = 5000m
*.sop.mobility.initialZ               = 0m

#################################################################
# 7. Satellite inserter + radio medium
#################################################################

# TLE-driven constellation insertion + SGP4 epoch
*.satelliteInserter.ignoreUnknownSatellites         = false
*.satelliteInserter.pathToTleFile                   = "TLEs/space_Veins-1.txt"
*.satelliteInserter.wall_clock_sim_start_time_utc   = "2022-02-22-13-42-34"

# Dedicated satellite radio medium
*.satelliteRadioMedium.typename = "UnitDiskRadioMedium"
*.satelliteRadioMedium.mediumLimitCache.minElevationAngleV2S = 5deg
*.satelliteRadioMedium.mediumLimitCache.disableS2SCommunication = true

#################################################################
# 8. Satellites (dynamic) — SGP4 + IPv4 / multicast settings
#################################################################

*.leo*[*].mobility.typename                         = "SGP4Mobility"
*.leo*[*].mobility.updateInterval                   = 1s
#*.leo*[*].mobility.enableCache                      = true
#*.leo*[*].mobility.precalculationIntervalInMinutes  = 16

# NOTE: we are NOT using compat.CompatIpv4Layer wrapper anymore.
# The default INET IPv4 stack is used, and we configure forwarding
# explicitly via params below.
#*.leo[*].nl.typename = "compat.CompatIpv4Layer"

# Give satellites an IPv4 stack and enable forwarding + multicast forwarding
*.leo*[*].hasIpv4             = true
*.leo*[*].forwarding          = true
*.leo*[*].multicastForwarding = true
*.leo*[*].igmp.typename       = "Igmpv2Router"

# Optional: UDP sink on satellites to observe arrivals (does not block forwarding)
*.leo*[*].numApps                   = 1
*.leo*[*].app[0].typename           = "inet.applications.udpapp.UdpSink"
#*.leo*[*].app[0].interface          = "satNic0"
*.leo*[*].app[0].localPort          = 4000
*.leo*[*].app[0].receiveBroadcast   = true
# If you want the satellite itself to join the multicast group:
#*.leo*[*].app[0].joinLocalMulticastGroups = true

*.leo*[*].numLoInterfaces   = 0
*.leo*[*].numSatelliteNics  = 2

#################################################################
# 9. Vehicles (SatCar) — IPv4 and no forwarding
#################################################################

*.node[*].mobility.typename    = "VeinsInetMobility"
*.node[*].numSatelliteNics     = 1
*.node[*].numLoInterfaces      = 0
*.node[*].hasIpv4              = true
*.node[*].useSamac             = false

# We keep the default INET IPv4 layer for cars as well.
#*.node[*].nl.typename= "compat.CompatIpv4Layer"

# Cars are pure hosts, no routing
*.node[*].forwarding           = false
*.node[*].multicastForwarding  = false

#################################################################
# 10. Satellite NICs (cars + satellites) — fully explicit
#################################################################

# Type name for all satellite NICs (if SatelliteInterface NED exists; otherwise comment)
*.**.satNic[*].typename = "SatelliteInterface"

# MAC layer on all satellite NICs
*.**.satNic[*].mac.typename      = "AckingMac"
*.**.satNic[*].mac.headerLength  = 32B
*.**.satNic[*].mac.fullDuplex    = true
*.**.satNic[*].mac.useAck        = false

# Radio on all satellite NICs
*.**.satNic[*].radio.typename                    = "UnitDiskRadio"
*.**.satNic[*].radio.radioMediumModule           = "satelliteRadioMedium"
*.**.satNic[*].radio.antenna.mobilityModule      = "^.^.^.mobility"
*.**.satNic[*].radio.transmitter.communicationRange = 6000km
*.**.satNic[*].radio.transmitter.headerLength    = 8bit
*.**.satNic[*].radio.transmitter.preambleDuration = 0

# Asymmetric link rates (apply to all sat NICs)
*.leo*[*].satNic[*].mac.bitrate               = 100Mbps   # satellite side
*.node[*].satNic[*].mac.bitrate               = 10Mbps    # car side
*.leo*[*].satNic[*].radio.transmitter.bitrate = 100Mbps
*.node[*].satNic[*].radio.transmitter.bitrate = 10Mbps

# Interference handling
*.leo*[*].satNic[*].radio.receiver.ignoreInterference = false
*.node[*].satNic[*].radio.receiver.ignoreInterference = true

#################################################################
# 11. Application layer — car0 sender, cars1..4 receivers
#################################################################

# Everyone has exactly one app
*.node[*].numApps = 1

# --- Car 0: SENDER ONLY (uplink → satellite, then multicast down) ---
*.node[0].app[0].typename      = "inet.applications.udpapp.UdpBasicApp"
*.node[0].app[0].destAddresses = "239.1.1.1"    # multicast group
*.node[0].app[0].destPort      = 4000
*.node[0].app[0].localPort     = 4000
*.node[0].app[0].messageLength = 50B
*.node[0].app[0].packetName    = "Alert"
*.node[0].app[0].receiveBroadcast         = false
*.node[0].app[0].joinLocalMulticastGroups = true   # standard-compliant, though not strictly needed here
*.node[0].app[0].startTime     = 7s                # first send at 7 s
*.node[0].app[0].sendInterval  = 10s               # periodic forever
*.node[0].app[0].stopTime      = -1s
*.node[*].numWlanInterfaces    = 0                 # we only use satNic, no WLAN

# --- Cars 1..4: RECEIVERS ONLY (downlink from satellite) ---
*.node[1..4].igmp.typename     = "Igmpv2Host"

*.node[1..4].app[0].typename   = "inet.applications.udpapp.UdpSink"
*.node[1..4].app[0].localPort  = 4000
*.node[1..4].app[0].receiveBroadcast         = true
*.node[1..4].app[0].joinLocalMulticastGroups = true
*.node[1..4].app[0].startTime  = 2s               # ready before first Alert at t=7 s
*.node[1..4].app[0].multicastInterface = "satNic0"

#################################################################
# 12. Visualisation + legacy WLAN (kept but irrelevant)
#################################################################

# Visualisation: keep things simple
*.visualizer.*.radioVisualizer[0].displayRadios        = false
*.visualizer.*.mediumVisualizer[0].displaySignals      = false
*.visualizer.*.dataLinkVisualizer[0].displayLinks      = false
#*.visualizer.*.packetRouteVisualizer[0].displayRoutes  = false

# Legacy WLAN config (ineffective because numWlanInterfaces = 0)
*.wlanRadioMedium.typename              = "Ieee80211DimensionalRadioMedium"
*.**.wlan[*].opMode                     = "p"
*.**.wlan[*].mgmt.typename              = "Ieee80211MgmtAdhoc"
*.**.wlan[*].agent.typename             = ""
*.**.wlan[*].radio.typename             = "Ieee80211DimensionalRadio"
*.**.wlan[*].radio.radioMediumModule    = "wlanRadioMedium"



##############################
# Recording
##############################

#**.globalStatistics.*.scalar-recording = true
#**.globalStatistics.*.vector-recording = true
#**.vehicleStatistics.*.scalar-recording = true
#*.node[*].app[0].rcvdPkLifetime:vector.vector-recording = true
##*.node[*].app[0].packetReceived:count.scalar-recording = true
#*.node[*].app[0].packetSent:count.scalar-recording = true


**.scalar-recording = true
**.vector-recording = true

output-vector-file = "results/5km.vec"
output-scalar-file = "results/5km.sca"


