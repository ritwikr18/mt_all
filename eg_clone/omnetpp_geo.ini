[General]

#################################################################
# 1. Network + satellite host type
#################################################################

network = SatelliteAlertGrid

# Use our custom satellite host type that embeds MulticastConfigurator
# NOTE: this MUST match the NED type name in McastSatellite.ned.
*.satelliteType = "mcast.McastSatellite"

# If SatelliteInserter exists, keep type consistent (but we won't use it for GEO)
*.satelliteInserter.satelliteModuleType = "mcast.McastSatellite"

#################################################################
# 2. Basic simulation settings
#################################################################

warmup-period           = ${warmupPeriod=5}s
sim-time-limit          = 120s
repeat                  = 1
cmdenv-express-mode     = true
cmdenv-autoflush        = true
cmdenv-status-frequency = 1s
debug-on-errors         = true

#################################################################
# 3. Physical environment
#################################################################

# Map size for the Kronach scenario (keep X/Y, enlarge Z for GEO)
*.playgroundSizeX = 50000m
*.playgroundSizeY = 50000m
*.playgroundSizeZ = 50000km
*.physicalEnvironment.ground.typename = "FlatGround"

#################################################################
# 4. IPv4 configuration (Global configurator)
#################################################################

*.configurator.typename                      = "Ipv4NetworkConfigurator"
*.configurator.assignDisjunctSubnetAddresses = true
*.configurator.addStaticRoutes               = true
#*.configurator.addMulticastRoutes            = true
*.configurator.addDefaultRoutes              = true

# If you want XML routes:
#**.routingTable.routes = xmldoc("mroutes.xml")

#################################################################
# 5. TraCI (SUMO) and vehicle insertion
#################################################################

*.manager.launchConfig   = xmldoc("kronach_2.launchd.xml")
*.manager.host           = "localhost"
*.manager.port           = 9999
*.manager.moduleType     = "space_veins.nodes.SatCar"
*.manager.moduleName     = "node"         # vehicles go into node[]
*.manager.updateInterval = 0.1s
*.manager.autoShutdown   = true

# No random vehicles; use the route file only
#*.vehicleInserter.numVehicles = 0

##########################################################
# 6. SOP (position of the observer / reference point)
##########################################################

*.sop.sumoNetXmlFile                   = xmldoc("kronach_2.net.xml")
*.sop.mobility.updateFromDisplayString = false
*.sop.mobility.initFromDisplayString   = false
*.sop.mobility.initialX  = 13868.89m
*.sop.mobility.initialY  = 4288.23m
*.sop.mobility.initialZ  = 0m

#################################################################
# 7. Satellite inserter + radio medium
#    (inert for GEO: no TLEs, just static GEO node)
#################################################################

# Make SatelliteInserter effectively inert for GEO scenario
*.satelliteInserter.ignoreUnknownSatellites       = true
*.satelliteInserter.pathToTleFile                 = ""
*.satelliteInserter.wall_clock_sim_start_time_utc = "1970-01-01-00-00-00"

# Dedicated satellite radio medium
*.satelliteRadioMedium.typename = "UnitDiskRadioMedium"
*.satelliteRadioMedium.mediumLimitCache.minElevationAngleV2S = 5deg
*.satelliteRadioMedium.mediumLimitCache.disableS2SCommunication = true

#################################################################
# 8. GEO satellite (static) — position + IPv4 / multicast settings
#################################################################
# using geo
*.numGeos = 1

# Single GEO satellite instance (geo[0] from SatelliteAlertGrid.ned)
*.geo[0].typename = "mcast.McastSatellite"

# Static GEO position above the Kronach area
# X/Y: choose the rough center of your Kronach map (here we just reuse SOP-ish values)
*.geo[0].mobility.typename  = "StationaryMobility"
*.geo[0].mobility.initialX  = 13868m
*.geo[0].mobility.initialY  = 4288.23m
*.geo[0].mobility.initialZ  = 35786km   # GEO altitude

# IPv4 and routing on GEO
*.geo[0].hasIpv4             = true
*.geo[0].forwarding          = true
*.geo[0].multicastForwarding = true
*.geo[0].igmp.typename       = "Igmpv2Router"

# UDP sink on satellite - REQUIRED for multicast route installation
*.geo[0].numApps                 = 0
#*.geo[0].app[0].typename         = "inet.applications.udpapp.UdpSink"
#*.geo[0].app[0].localPort        = 4000
#*.geo[0].app[0].receiveBroadcast = true
#*.geo[0].app[0].joinLocalMulticastGroups = true

# Enable multicast routing on GEO
*.geo[0].ipv4.ip.multicastRouting = true

# Number of interfaces
*.geo[0].numLoInterfaces   = 0
*.geo[0].numSatelliteNics  = 2

#################################################################
# 9. MulticastConfigurator parameters for GEO satellite
#################################################################

# (*,G) route description for GEO satellite:
#  - Group: 239.1.1.1
#  - Uplink  in-interface : satNic0 (cars → GEO)
#  - Downlink out-interface: satNic1 (GEO → other cars)
**.geo*[0].mcastGroupAddress   = "239.1.1.1"
**.geo*[0].mcastOriginAddress  = "0.0.0.0"
**.geo*[0].mcastOriginNetmask  = "0.0.0.0"
**.geo*[0].mcastInInterface    = "satNic0"
**.geo*[0].mcastOutInterfaces  = "satNic1"

#################################################################
# 10. Vehicles (SatCar) — IPv4 and no forwarding
#################################################################

*.node[*].mobility.typename   = "VeinsInetMobility"
*.node[*].numSatelliteNics    = 1
*.node[*].numLoInterfaces     = 0
*.node[*].hasIpv4             = true
*.node[*].useSamac            = false

# Cars are pure hosts, no routing
*.node[*].forwarding          = false
*.node[*].multicastForwarding = false

#################################################################
# 11. Satellite NICs (cars + GEO) — fully explicit
#################################################################

# Type name for all satellite NICs
*.**.satNic[*].typename = "SatelliteInterface"

# MAC layer on all satellite NICs
*.**.satNic[*].mac.typename     = "AckingMac"
*.**.satNic[*].mac.headerLength = 32B
*.**.satNic[*].mac.fullDuplex   = true
*.**.satNic[*].mac.useAck       = false

# Radio on all satellite NICs
*.**.satNic[*].radio.typename                    = "UnitDiskRadio"
*.**.satNic[*].radio.radioMediumModule           = "satelliteRadioMedium"
*.**.satNic[*].radio.antenna.mobilityModule      = "^.^.^.mobility"
*.**.satNic[*].radio.transmitter.communicationRange = 45000km
*.**.satNic[*].radio.transmitter.headerLength    = 8bit
*.**.satNic[*].radio.transmitter.preambleDuration = 0

# Asymmetric link rates (apply to GEO and cars)
*.geo[0].satNic[*].mac.bitrate               = 100Mbps   # satellite side
*.node[*].satNic[*].mac.bitrate              = 10Mbps    # car side
*.geo[0].satNic[*].radio.transmitter.bitrate = 100Mbps
*.node[*].satNic[*].radio.transmitter.bitrate = 10Mbps

# Interference handling
*.geo[0].satNic[*].radio.receiver.ignoreInterference = false
*.node[*].satNic[*].radio.receiver.ignoreInterference = true

#################################################################
# 12. Application layer — car0 sender, cars1..4 receivers
#################################################################

# Everyone has exactly one app
*.node[*].numApps = 1

# --- Car 0: SENDER ONLY (uplink → GEO, then multicast down) ---
*.node[0].app[0].typename      = "inet.applications.udpapp.UdpBasicApp"
*.node[0].app[0].destAddresses = "239.1.1.1"    # multicast group
*.node[0].app[0].destPort      = 4000
*.node[0].app[0].localPort     = 4000
*.node[0].app[0].messageLength = 50B
*.node[0].app[0].packetName    = "Alert"
*.node[0].app[0].receiveBroadcast         = false
*.node[0].app[0].joinLocalMulticastGroups = true
*.node[0].app[0].startTime     = 7s
*.node[0].app[0].sendInterval  = 10s
*.node[0].app[0].stopTime      = -1s

*.node[*].numWlanInterfaces    = 0   # we only use satNic, no WLAN

# --- Cars 1..4: RECEIVERS ONLY (downlink from GEO) ---
*.node[1..4].igmp.typename     = "Igmpv2Host"

# Enable multicast routing on receiver cars
*.node[1..4].ipv4.ip.multicastRouting = true

*.node[1..4].app[0].typename   = "inet.applications.udpapp.UdpSink"
*.node[1..4].app[0].localPort  = 4000
*.node[1..4].app[0].receiveBroadcast         = true
*.node[1..4].app[0].joinLocalMulticastGroups = true
*.node[1..4].app[0].startTime  = 2s
*.node[1..4].app[0].multicastInterface = "satNic0"

#################################################################
# 13. Visualisation + legacy WLAN (kept but irrelevant)
#################################################################

*.visualizer.*.radioVisualizer[0].displayRadios        = false
*.visualizer.*.mediumVisualizer[0].displaySignals      = false
*.visualizer.*.dataLinkVisualizer[0].displayLinks      = false
#*.visualizer.*.packetRouteVisualizer[0].displayRoutes  = false

# Legacy WLAN config (ineffective because numWlanInterfaces = 0)
*.wlanRadioMedium.typename              = "Ieee80211DimensionalRadioMedium"
*.**.wlan[*].opMode                     = "p"
*.**.wlan[*].mgmt.typename              = "Ieee80211MgmtAdhoc"
*.**.wlan[*].agent.typename             = ""
*.**.wlan[*].radio.typename             = "Ieee80211DimensionalRadio"
*.**.wlan[*].radio.radioMediumModule    = "wlanRadioMedium"

##############################
# 14. Recording
##############################

**.scalar-recording = true
**.vector-recording = true

output-vector-file = "results/geo.vec"
output-scalar-file = "results/geo.sca"

